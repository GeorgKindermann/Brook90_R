---
title: "MainProg"
author: "Rico Kronenberg, Lisa Marie Oehlschlägel"
date: "14 April 2018"
output: html_document
---

###Main Programm
BROOK90 simulates vertical soil water movement and daily evapotranspiration for all land surfaces at all times of year using a process-oriented approach with physically-meaningful parameters. Only enough streamflow generation pathways are included to allow comparison with measured streamflow where available (see [flow chart](http://www.ecoshift.net/brook/flowchrt.html)). The complexities of hillslope hydrology and spatial distribution have been omitted in order to focus on the details of the factors controlling evaporation.

BROOK90 can fill a wide range of needs: as a research tool to study the water budget and water movement on small plots, as a teaching tool for evaporation and soil water processes, as a water budget model for land managers and for predicting climate change effects, and as a fairly complex water budget model against which simpler models can be tested.

Input of daily precipitation and maximum and minimum temperatures is required, and daily solar radiation, vapor pressure, and wind speed are desirable. The model estimates interception and transpiration from a single layer (big leaf) plant canopy, soil and snow evaporation, snow accumulation and melt, and soil-water movement through one or more soil layers (including macropore-assisted infiltration). Stormflow is generated by a variable source area or simple pipe flow. Delayed flow is from soil drainage and a first-order groundwater storage. BROOK90 uses a Shuttleworth-Wallace modification to Penman-Monteith potential evaporation in order to separate transpiration and soil evaporation from sparse canopies. Actual transpiration is reduced below potential using Federer's method based on root density with depth, plant resistance, and a critical leaf-water potential. Water movement between soil layers is integrated using Darcy's Law and variable time-steps. 

The documenation of all scripts is done with R-Markdown. The main programm is used to set initial parameters, upload necessary scripts and the input data.

###Contents

* [Start Brook90](#start-brook90)
* [Load all variables](#load-all-variables)
* [Load meteorological and precipitation file](#load-meteorological-and-precipitation-file)

###Start Brook90
Before loading all variables into Brook90 you have to remove all objects except functions with the following command.

```{r}
rm(list = setdiff(ls(), lsf.str()))
```


###Load all variables
Before loading the variables some parameters will be set.

Parameter |Value|Description
----------|-----|-------------
NPINT     |1    |number of precipitation intervals per day  1=1 Tag, 24 = 24 Stunden pro Tag
SUBDAYDATA|FALSE| #TRUE#TRUE
RRD       |0.55 |default ratio of solar radiation to potential
UWD       |3.0  |default wind speed at weather station

```{r}
NPINT <- 1           
SUBDAYDATA <- FALSE
RRD <- 0.55
UWD <- 3.0

```

If it is needed, change catchment parameters in GLOBELDEC.R. 

It is important to define your scriptpath to upload the necessary scripts including the variables and to run the programm. The following table shows the description of the scriptnames. 

Variable            | Description
--------------------|---------------
GLOBDECL_WERNERSBACH| Global Declaration of Wernersbach (catchment area)
AXX                 | Auxiliary Routines
KPT                 | Soil Water Properties
EVP                 | Statistics
PET                 | Potential Evaporation
SUN                 | Radiation
WAT                 | Water Movement in Soil
SNO                 | Snow Accumulation and Melt
B90v4_sub           | Subroutine

```{r}
SCRIPTPATH<-"c:\\Users\\LM\\Documents\\BROOK90\\Documentation\\Data_and_R_Code\\"

source(file.path(SCRIPTPATH,"GLOBDECL_WERNERSBACH.R"))
source(file.path(SCRIPTPATH,"AXX.R"))
source(file.path(SCRIPTPATH,"KPT.R"))
source(file.path(SCRIPTPATH,"EVP.R"))
source(file.path(SCRIPTPATH,"PET.R"))
source(file.path(SCRIPTPATH,"SUN.R"))
source(file.path(SCRIPTPATH,"WAT.R"))
source(file.path(SCRIPTPATH,"SNO.R"))
source(file.path(SCRIPTPATH,"B90V4_sub.R"))
```

###Load meteorological and precipitation file
Both datasets will be uploaded and with this data for each set a matrix has been created. The datasets don't have have a header, so the following table shows the included data.

column  |Meteorological file      | Precipitation file              
--------|-------------------------|-------------
1       |Year                     |Year
2       |Month                    |Month
3       |Day                      |Day
4       |Solar radiation (MJ/m2)  |Number of precipitation interval
5       |TMAX(°C)                 |Precipitation (mm)
6       |TMIN(°C)                 |Average measured streamflow rate (mm/d),if not available it should be set -1
7       |Vapor pressure (kPa)     |/
8       |Wind speed (m/s)         |/
9       |Precipitation (mm)       |/
10      |Measured streamflow (mm) |/

To upload the scripts with the variables and the datasets use "Run from source" for the script "MainProg.R". If this is done the model can be started. The file "B90V4.R" has to be opened and started with "Run from source" to run BROOK90 in R.

```{r}
meteoFile <-read.table(file.path(SCRIPTPATH,"data_input_WB_1999_point.txt"))
MData<-matrix(meteoFile)

precFile <-read.table(file.path(SCRIPTPATH,"P_WBG_0060_Minuten_1999_point.txt"))
MhhData<-matrix(precFile)
```